<AnalysisScreen>:
    name: "analysis"

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: root.pos
            size: root.size
    
    MDBoxLayout:
        orientation: "vertical"
        MDTopAppBar:
            size_hint_y: .1
            MDTopAppBarTitle:
                text: "NeptuneHMS (Analysis)"
                theme_text_color: "Custom"
                text_color: "navy"
                theme_font_size: "Custom"
                font_size: sp(30)
                bold: True
            MDTopAppBarTrailingButtonContainer:
                MDActionTopAppBarButton:
                    icon: "refresh"
                    theme_icon_color: "Custom"
                    icon_color: "green"
                    on_release: root.refresh_content()
                MDActionTopAppBarButton:
                    icon: "logout"
                    theme_icon_color: "Custom"
                    icon_color: "red"
                    on_release: root.manager.current = "admin"
        MDBoxLayout:

            MDBoxLayout:
                size_hint_x: .7
                orientation: "vertical"
                padding: dp(10)
                MDScrollView:
                    MDGridLayout:
                        cols: 1
                        adaptive_height: True
                        spacing: dp(10)
                        MDLabel:
                            text: "Patients"
                            adaptive_height: True
                            theme_text_color: "Custom"
                            text_color: "blue"
                            theme_font_size: "Custom"
                            font_size: sp(28)
                            bold: True
                        MDScrollView:
                            size_hint_y: None
                            height: dp(150)
                            bar_width: 0
                            MDGridLayout:
                                size_hint_x: None
                                width: self.minimum_width
                                adaptive_height: True
                                rows: 1
                                padding: dp(10)
                                spacing: dp(10)
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1
                                    on_release: root.display_patients("total")  

                                    MDLabel:
                                        text: "Total"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "green"
                                        halign: "center"

                                    MDLabel:
                                        id: total_patients_label
                                        text: "0"      
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "green"
                                        halign: "center"


                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1   
                                    on_release: root.display_patients("new")

                                    MDLabel:
                                        text: "New"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "blue"
                                        halign: "center"

                                    MDLabel:
                                        id: new_patients_label
                                        text: "0" 
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "blue"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1 
                                    on_release: root.display_patients("adults") 

                                    MDLabel:
                                        text: "Adults"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "navy"
                                        halign: "center"

                                    MDLabel:
                                        id: adult_patients_label
                                        text: "0"
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "navy"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1  
                                    on_release: root.display_patients("children")

                                    MDLabel:
                                        text: "Children"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "teal"
                                        halign: "center"

                                    MDLabel:
                                        id: child_patients_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "teal"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1
                                    on_release: root.display_patients("male")  

                                    MDLabel:
                                        text: "Male"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "brown"
                                        halign: "center"

                                    MDLabel:
                                        id: male_patients_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "brown"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1  
                                    on_release: root.display_patients("female") 

                                    MDLabel:
                                        text: "Female"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"

                                    MDLabel:
                                        id: female_patients_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"
                        MDBoxLayout:
                            padding: dp(10)
                            spacing: dp(10)
                            size_hint_y: None
                            height: dp(500)
                            MDBoxLayout:
                                id: weekly_patients
                            MDDivider:
                                orientation: "vertical"
                            MDBoxLayout:
                                id: monthly_patients
                        
                        MDLabel:
                            text: "Drugs"
                            adaptive_height: True
                            theme_text_color: "Custom"
                            text_color: "blue"
                            theme_font_size: "Custom"
                            font_size: sp(28)
                            bold: True
                        MDScrollView:
                            size_hint_y: None
                            height: dp(150)
                            bar_width: 0
                            MDGridLayout:
                                size_hint_x: None
                                width: self.minimum_width
                                adaptive_height: True
                                rows: 1
                                padding: dp(10)
                                spacing: dp(10)
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1  
                                    on_release: root.display_drugs("total")

                                    MDLabel:
                                        text: "Total"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "green"
                                        halign: "center"

                                    MDLabel:
                                        id: total_drugs_label
                                        text: "0"      
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "green"
                                        halign: "center"


                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1  
                                    on_release: root.display_drugs("new") 

                                    MDLabel:
                                        text: "New"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "blue"
                                        halign: "center"

                                    MDLabel:
                                        id: new_drugs_label
                                        text: "0" 
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "blue"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1 
                                    on_release: root.display_drugs("expired") 

                                    MDLabel:
                                        text: "Expired"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "navy"
                                        halign: "center"

                                    MDLabel:
                                        id: expired_drugs_label
                                        text: "0"
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "navy"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1 
                                    on_release: root.display_drugs("safe") 

                                    MDLabel:
                                        text: "Safe"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "teal"
                                        halign: "center"

                                    MDLabel:
                                        id: safe_drugs_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "teal"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1 
                                    on_release: root.display_drugs("available") 

                                    MDLabel:
                                        text: "Available"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "brown"
                                        halign: "center"

                                    MDLabel:
                                        id: available_drugs_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "brown"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1 
                                    on_release: root.display_drugs("depleted")  

                                    MDLabel:
                                        text: "Depleted"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"

                                    MDLabel:
                                        id: depleted_drugs_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"
                                MDCard:
                                    size_hint: None, None
                                    size: dp(250), dp(100)
                                    radius: dp(20)
                                    orientation: "vertical"
                                    padding: dp(20)
                                    spacing: dp(10)
                                    theme_bg_color: "Custom"
                                    md_bg_color: 0.88, 0.93, 0.97, 1   
                                    on_release: root.display_drugs("sellable")

                                    MDLabel:
                                        text: "Sellable"
                                        theme_font_size: "Custom"
                                        font_size: sp(28)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"

                                    MDLabel:
                                        id: sellable_drugs_label
                                        text: "0"     
                                        theme_font_size: "Custom"
                                        font_size: sp(30)
                                        bold: True
                                        theme_text_color: "Custom"
                                        text_color: "purple"
                                        halign: "center"
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(500)
                            MDBoxLayout:
                                id: drug_pie_chart
                            MDDivider:
                                orientation: "vertical"
                            MDBoxLayout:
                                id: drug_donut_chart
                            
                        MDLabel:
                            text: "Revenue"
                            adaptive_height: True
                            theme_text_color: "Custom"
                            text_color: "blue"
                            theme_font_size: "Custom"
                            font_size: sp(28)
                            bold: True
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(300)
                            spacing: dp(10)
                            padding: dp(10)
                            MDCard:
                                size_hint_y: None
                                height: dp(250)
                                size_hint_x: .5
                                radius: dp(20)
                                orientation: "vertical"
                                padding: dp(20)
                                spacing: dp(10)
                                theme_bg_color: "Custom"
                                md_bg_color: 0.88, 0.93, 0.97, 1   

                                MDLabel:
                                    text: "Last Month"
                                    theme_font_size: "Custom"
                                    font_size: sp(40)
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: "grey"
                                    halign: "center"

                                MDLabel:
                                    id: last_month_revenue
                                    text: "0"     
                                    theme_font_size: "Custom"
                                    font_size: sp(60)
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: "grey"
                                    halign: "center"
                            MDCard:
                                size_hint_y: None
                                height: dp(250)
                                size_hint_x: .5
                                radius: dp(20)
                                orientation: "vertical"
                                padding: dp(20)
                                spacing: dp(10)
                                theme_bg_color: "Custom"
                                md_bg_color: 0.88, 0.93, 0.97, 1   

                                MDLabel:
                                    text: "This Month"
                                    theme_font_size: "Custom"
                                    font_size: sp(40)
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: "purple"
                                    halign: "center"

                                MDLabel:
                                    id: this_month_revenue
                                    text: "0"     
                                    theme_font_size: "Custom"
                                    font_size: sp(60)
                                    bold: True
                                    theme_text_color: "Custom"
                                    text_color: "purple"
                                    halign: "center"
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(500)
                            id: monthly_revenue_waterfall
                        MDLabel:
                            text: "Filter Reports"
                            adaptive_height: True
                            theme_text_color: "Custom"
                            text_color: "blue"
                            theme_font_size: "Custom"
                            font_size: sp(28)
                            bold: True
                        MDCard:
                            size_hint_y: None
                            height: dp(60)
                            style: "outlined"
                            spacing: dp(10)
                            size_hint_x: None
                            width: dp(300)
                            padding: dp(10)
                            on_release: root.show_filter_dropdown(self)
                            MDLabel:
                                pos_hint: {"center_y":.5}
                                id: filter_text
                                text: "Appointments"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: "blue"
                                bold: True
                            MDIcon:
                                pos_hint: {"center_y":.5}
                                icon: "chevron-down"
                                theme_icon_color: "Custom"
                                icon_color: "blue"
                        MDGridLayout:
                            size_hint_y: None
                            height: dp(60)
                            cols: 2
                            size_hint_x: None
                            width: dp(500)
                            spacing: dp(10)
                            MDBoxLayout:
                                spacing: dp(10)
                                size_hint_y: None
                                height: dp(60)
                                MDTextField:
                                    pos_hint: {"center_y":.5}
                                    id: start_date_field
                                    MDTextFieldHintText:
                                        text: "Start Date"
                                MDIconButton:
                                    pos_hint: {"center_y":.5}
                                    on_release: root.show_date_picker(start_date_field)
                                    icon: "chevron-down"
                                    theme_icon_color: "Custom"
                                    icon_color: "blue"
                            MDBoxLayout:
                                spacing: dp(10)
                                size_hint_y: None
                                height: dp(60)
                                MDTextField:
                                    id: end_date_field
                                    pos_hint: {"center_y":.5}
                                    MDTextFieldHintText:
                                        text: "End Date"
                                MDIconButton:
                                    icon: "chevron-down"
                                    on_release: root.show_date_picker(end_date_field)
                                    pos_hint: {"center_y":.5}
                                    theme_icon_color: "Custom"
                                    icon_color: "blue"
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(150)
                            padding: dp(10)
                            spacing: dp(20)
                            MDExtendedFabButton:
                                pos_hint: {"center_y":.5}
                                fab_state: "expand"
                                on_release: root.download_filter_doc_pdf()
                                MDExtendedFabButtonIcon:
                                    icon: "file-pdf-box"
                                    theme_icon_color: "Custom"
                                    icon_color: "green"
                                MDExtendedFabButtonText:
                                    text: "Download PDF"
                                    theme_text_color: "Custom"
                                    text_color: "green"
                            MDExtendedFabButton:
                                pos_hint: {"center_y":.5}
                                fab_state: "expand"
                                on_release: root.download_filter_doc_csv()
                                MDExtendedFabButtonIcon:
                                    icon: "file-delimited"
                                    theme_icon_color: "Custom"
                                    icon_color: "green"
                                MDExtendedFabButtonText:
                                    text: "Download CSV"
                                    theme_text_color: "Custom"
                                    text_color: "green"
                            Widget:
                        Widget:

            
            MDDivider:
                orientation: "vertical"

            MDBoxLayout:
                size_hint_x: .3
                orientation: "vertical"
                MDLabel:
                    text: "Preview"
                    theme_text_color: "Custom"
                    text_color: "blue"
                    bold: True
                    theme_font_size: "Custom"
                    adaptive_height: True
                    font_size: sp(32)
                    halign: "center"
                MDDivider:
                RecycleView:
                    id: rec_view
                    scroll_type: ["bars", "content"]
                    bar_width: 10
                    size_hint: 1, 1
                    RecycleBoxLayout:
                        id: rec_box
                        default_size: None, dp(50)
                        default_size_hint: 1, None
                        orientation: "vertical"
                        padding: dp(10)
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height
                MDBoxLayout:
                    size_hint_y: None
                    height: dp(150)
                    padding: dp(10)
                    spacing: dp(20)
                    Widget:
                    MDExtendedFabButton:
                        pos_hint: {"center_y":.5}
                        fab_state: "expand"
                        id: pdf_downloader
                        MDExtendedFabButtonIcon:
                            icon: "file-pdf-box"
                            theme_icon_color: "Custom"
                            icon_color: "green"
                        MDExtendedFabButtonText:
                            text: "Download PDF"
                            theme_text_color: "Custom"
                            text_color: "green"
                    MDExtendedFabButton:
                        pos_hint: {"center_y":.5}
                        fab_state: "expand"
                        id: csv_downloader
                        MDExtendedFabButtonIcon:
                            icon: "file-delimited"
                            theme_icon_color: "Custom"
                            icon_color: "green"
                        MDExtendedFabButtonText:
                            text: "Download CSV"
                            theme_text_color: "Custom"
                            text_color: "green"
                    Widget:
